[[block]]
block = "custom"
command = "lyrics-line.sh"
interval = 3
format = "$text"
hide_when_empty = true

[[block]]
block = "custom"
format = "$icon $text"
command = "ping-json.sh"
json = true
interval =60

[[block]]
block = "cpu"
interval = 5
format = " $icon $barchart $utilization "
format_alt = " $icon $frequency{ $boost|} "
info_cpu = 20
warning_cpu = 50
critical_cpu = 90

# Memory usage
[[block]]
block = "memory"
format = " $icon $mem_used.eng(w:3)/$mem_total.eng(w:3) "
format_alt = " $icon_swap $swap_used.eng(w:3)/$swap_total.eng(w:3) "
warning_mem = 80.0
critical_mem = 95.0
interval = 5

# Disk space
[[block]]
block = "disk_space"
path = "/"
format = " $icon $used.eng(w:2)/$total.eng(w:2) ($percentage) "
info_type = "available"
warning = 20.0
alert = 10.0
interval = 60

# Network
[[block]]
block = "net"
format = "$icon {$signal_strength $ssid $frequency|Eth}"

[[block]]
block = "sound"
format = " $icon $output_name{ $volume|} "
[block.mappings]
"bluez_output.08_EB_ED_13_30_46.1"           = "" # Bluetooth + Headset
"bluez_output.B4.84_D5_C2_77_1F.1"           = "" # Bluetooth + Headset
"bluez_output.20.18_5B_0E_6B_31.1"             = "󰓃" # Bluetooth + nf-md-laptop-speaker
"alsa_output.pci-0000_00_1b.0.analog-stereo" = "" # nf-fa-headphones
"alsa_output.usb-Harman_Multimedia_JBL_Pebbles_1.0.0-00.analog-stereo" = "" # nf-fa-volume-up
"alsa_output.pci-0000_00_1f.3.analog-stereo" = "󰓃" # nf-md-laptop-speaker

[[block]]
block = "custom"
command = "cava.sh"
interval = "once"
format = " $text "
persistent = true

[[block]]
block = "sound"
driver = "pulseaudio"
device_kind = "source"
format = " $icon { $volume|} {$active_port |}"
[block.active_port_mappings]
"analog-input-internal-mic" = "" # Mapping to an empty string makes `$active_port` absent
"analog-input-rear-mic" = "" # Mapping to an empty string makes `$active_port` absent
"analog-input-front-mic" = "ERR!"

[[block]]
block = "battery"
format = " $icon $percentage {$time |}"
info = 60
good = 60
warning = 30
critical = 15

[[block]]
block = "backlight"
format = "$brightness"
device = "intel_backlight"
minimum = 5
maximum = 100
cycle = [5, 25, 50, 75, 100]


[[block]]
block = "time"
interval = 5
format = " $timestamp.datetime(f:'%a %d/%m %R') "

[[block]]
block = "custom"
interval = 1
command = '''
IFACE="wlo1"
STATE_FILE="/tmp/i3status_net_${IFACE}_mode"

# Read current mode (default: total)
MODE=$(cat ${STATE_FILE} 2>/dev/null || echo "total")

# Read current values
rx_curr=$(cat /sys/class/net/${IFACE}/statistics/rx_bytes 2>/dev/null || echo 0)
tx_curr=$(cat /sys/class/net/${IFACE}/statistics/tx_bytes 2>/dev/null || echo 0)

# Format function
format_bytes() {
  awk -v b=$1 -v suffix="$2" 'BEGIN {
    rate=1024;
    if(b < rate)
      printf("%.1f%sB%s", b, suffix, suffix ? "" : "")
    else if(b < rate*rate)
      printf("%.1f%sK%s", b/rate, suffix, suffix ? "" : "B")
    else if(b < rate*rate*rate)
      printf("%.1f%sM%s", b/(rate*rate), suffix, suffix ? "" : "B")
    else if(b < rate*rate*rate*rate)
      printf("%.1f%sG%s", b/(rate*rate*rate), suffix, suffix ? "" : "B")
    else
      printf("%.1f%sT%s", b/(rate*rate*rate*rate), suffix, suffix ? "" : "B")
  }'
}

if [ "$MODE" = "rate" ]; then
  # Show rates
  RX_FILE="/tmp/i3status_rx_${IFACE}"
  TX_FILE="/tmp/i3status_tx_${IFACE}"

  rx_prev=$(cat ${RX_FILE} 2>/dev/null || echo ${rx_curr})
  tx_prev=$(cat ${TX_FILE} 2>/dev/null || echo ${tx_curr})

  rx_rate=$((rx_curr - rx_prev))
  tx_rate=$((tx_curr - tx_prev))

  echo ${rx_curr} > ${RX_FILE}
  echo ${tx_curr} > ${TX_FILE}

  rx_fmt=$(format_bytes ${rx_rate} "/s")
  tx_fmt=$(format_bytes ${tx_rate} "/s")

  echo "↓${rx_fmt} ↑${tx_fmt}"
else
  # Show totals
  rx_fmt=$(format_bytes ${rx_curr} "")
  tx_fmt=$(format_bytes ${tx_curr} "")

  echo "↓${rx_fmt} ↑${tx_fmt}"
fi
'''
[[block.click]]
button = "left"
cmd = '''
IFACE="wlo1"
STATE_FILE="/tmp/i3status_net_${IFACE}_mode"
MODE=$(cat ${STATE_FILE} 2>/dev/null || echo "total")
if [ "$MODE" = "total" ]; then
  echo "rate" > ${STATE_FILE}
else
  echo "total" > ${STATE_FILE}
fi
'''
